/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/
(function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(b,e){var g=a,d=[];e=e||g.length;if(b){for(var c=0;c<b;c++){d[c]=g[0|Math.random()*e]}}else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(var c=0;c<36;c++){if(!d[c]){f=0|Math.random()*16;d[c]=g[(c==19)?(f&3)|8:f]}}}return d.join("")};Math.uuidFast=function(){var f=a,d=new Array(36),c=0,e;for(var b=0;b<36;b++){if(b==8||b==13||b==18||b==23){d[b]="-"}else{if(b==14){d[b]="4"}else{if(c<=2){c=33554432+(Math.random()*16777216)|0}e=c&15;c=c>>4;d[b]=f[(b==19)?(e&3)|8:e]}}}return d.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)}).toUpperCase()}})();var Crypto={};(function(){Crypto.MD5=function(s){function K(b,a){return(b<<a)|(b>>>(32-a))}function J(k,b){var F,a,d,x,c;d=(k&2147483648);x=(b&2147483648);F=(k&1073741824);a=(b&1073741824);c=(k&1073741823)+(b&1073741823);if(F&a){return(c^2147483648^d^x)}if(F|a){if(c&1073741824){return(c^3221225472^d^x)}else{return(c^1073741824^d^x)}}else{return(c^d^x)}}function r(a,c,b){return(a&c)|((~a)&b)}function q(a,c,b){return(a&b)|(c&(~b))}function p(a,c,b){return(a^c^b)}function n(a,c,b){return(c^(a|(~b)))}function u(G,F,Z,Y,k,H,I){G=J(G,J(J(r(F,Z,Y),k),I));return J(K(G,H),F)}function f(G,F,Z,Y,k,H,I){G=J(G,J(J(q(F,Z,Y),k),I));return J(K(G,H),F)}function D(G,F,Z,Y,k,H,I){G=J(G,J(J(p(F,Z,Y),k),I));return J(K(G,H),F)}function t(G,F,Z,Y,k,H,I){G=J(G,J(J(n(F,Z,Y),k),I));return J(K(G,H),F)}function e(k){var G;var d=k.length;var c=d+8;var b=(c-(c%64))/64;var F=(b+1)*16;var H=Array(F-1);var a=0;var x=0;while(x<d){G=(x-(x%4))/4;a=(x%4)*8;H[G]=(H[G]|(k.charCodeAt(x)<<a));x++}G=(x-(x%4))/4;a=(x%4)*8;H[G]=H[G]|(128<<a);H[F-2]=d<<3;H[F-1]=d>>>29;return H}function B(c){var b="",d="",k,a;for(a=0;a<=3;a++){k=(c>>>(a*8))&255;d="0"+k.toString(16);b=b+d.substr(d.length-2,2)}return b}var C=Array();var O,h,E,v,g,X,W,V,U;var R=7,P=12,M=17,L=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var T=6,S=10,Q=15,N=21;C=e(s);X=1732584193;W=4023233417;V=2562383102;U=271733878;for(O=0;O<C.length;O+=16){h=X;E=W;v=V;g=U;X=u(X,W,V,U,C[O+0],R,3614090360);U=u(U,X,W,V,C[O+1],P,3905402710);V=u(V,U,X,W,C[O+2],M,606105819);W=u(W,V,U,X,C[O+3],L,3250441966);X=u(X,W,V,U,C[O+4],R,4118548399);U=u(U,X,W,V,C[O+5],P,1200080426);V=u(V,U,X,W,C[O+6],M,2821735955);W=u(W,V,U,X,C[O+7],L,4249261313);X=u(X,W,V,U,C[O+8],R,1770035416);U=u(U,X,W,V,C[O+9],P,2336552879);V=u(V,U,X,W,C[O+10],M,4294925233);W=u(W,V,U,X,C[O+11],L,2304563134);X=u(X,W,V,U,C[O+12],R,1804603682);U=u(U,X,W,V,C[O+13],P,4254626195);V=u(V,U,X,W,C[O+14],M,2792965006);W=u(W,V,U,X,C[O+15],L,1236535329);X=f(X,W,V,U,C[O+1],A,4129170786);U=f(U,X,W,V,C[O+6],z,3225465664);V=f(V,U,X,W,C[O+11],y,643717713);W=f(W,V,U,X,C[O+0],w,3921069994);X=f(X,W,V,U,C[O+5],A,3593408605);U=f(U,X,W,V,C[O+10],z,38016083);V=f(V,U,X,W,C[O+15],y,3634488961);W=f(W,V,U,X,C[O+4],w,3889429448);X=f(X,W,V,U,C[O+9],A,568446438);U=f(U,X,W,V,C[O+14],z,3275163606);V=f(V,U,X,W,C[O+3],y,4107603335);W=f(W,V,U,X,C[O+8],w,1163531501);X=f(X,W,V,U,C[O+13],A,2850285829);U=f(U,X,W,V,C[O+2],z,4243563512);V=f(V,U,X,W,C[O+7],y,1735328473);W=f(W,V,U,X,C[O+12],w,2368359562);X=D(X,W,V,U,C[O+5],o,4294588738);U=D(U,X,W,V,C[O+8],m,2272392833);V=D(V,U,X,W,C[O+11],l,1839030562);W=D(W,V,U,X,C[O+14],j,4259657740);X=D(X,W,V,U,C[O+1],o,2763975236);U=D(U,X,W,V,C[O+4],m,1272893353);V=D(V,U,X,W,C[O+7],l,4139469664);W=D(W,V,U,X,C[O+10],j,3200236656);X=D(X,W,V,U,C[O+13],o,681279174);U=D(U,X,W,V,C[O+0],m,3936430074);V=D(V,U,X,W,C[O+3],l,3572445317);W=D(W,V,U,X,C[O+6],j,76029189);X=D(X,W,V,U,C[O+9],o,3654602809);U=D(U,X,W,V,C[O+12],m,3873151461);V=D(V,U,X,W,C[O+15],l,530742520);W=D(W,V,U,X,C[O+2],j,3299628645);X=t(X,W,V,U,C[O+0],T,4096336452);U=t(U,X,W,V,C[O+7],S,1126891415);V=t(V,U,X,W,C[O+14],Q,2878612391);W=t(W,V,U,X,C[O+5],N,4237533241);X=t(X,W,V,U,C[O+12],T,1700485571);U=t(U,X,W,V,C[O+3],S,2399980690);V=t(V,U,X,W,C[O+10],Q,4293915773);W=t(W,V,U,X,C[O+1],N,2240044497);X=t(X,W,V,U,C[O+8],T,1873313359);U=t(U,X,W,V,C[O+15],S,4264355552);V=t(V,U,X,W,C[O+6],Q,2734768916);W=t(W,V,U,X,C[O+13],N,1309151649);X=t(X,W,V,U,C[O+4],T,4149444226);U=t(U,X,W,V,C[O+11],S,3174756917);V=t(V,U,X,W,C[O+2],Q,718787259);W=t(W,V,U,X,C[O+9],N,3951481745);X=J(X,h);W=J(W,E);V=J(V,v);U=J(U,g)}var i=B(X)+B(W)+B(V)+B(U);return i.toLowerCase()}})();(function(){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB;window.IDBCursor=window.IDBCursor||window.webkitIDBCursor;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction;window.IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException;var f=this;var g={};if(typeof exports!=="undefined"){exports.pouch=g}else{f.pouch=g}var e=1;var d={};var a="document-store";var b="by-sequence";var i=function(){var k=arguments[0];var l=Array.prototype.slice.call(arguments);l.shift();if(typeof k===typeof Function){k.apply(this,l)}};var j=function(m,l){if(l){if(!m._id){m._id=Math.uuid()}var n=Math.uuid(32,16);if(m._rev){var k=/^(\d+)-(.+)$/.exec(m._rev);if(!k){throw"invalid value for property '_rev'"}m._revisions={start:parseInt(k[1],10)+1,ids:[n,k[2]]}}else{m._revisions={start:1,ids:[n]}}}else{if(!m._revisions){throw"missing property '_revisions'"}if(!isFinite(m._revisions.start)){throw"property '_revisions.start' must be a number"}if(Array.isArray(m._revisions)&&m._revisions.length>0){throw"property '_revisions.id' must be a non-empty array"}}m._id=decodeURIComponent(m._id);m._rev=[m._revisions.start,m._revisions.ids[0]].join("-");return Object.keys(m).reduce(function(p,o){if(/^_/.test(o)){p.metadata[o.slice(1)]=m[o]}else{p.data[o]=m[o]}return p},{metadata:{},data:{}})};var h=function(l,k){if(l.id!==k.id){return(l.id<k.id?-1:1)}if(l.deleted^k.deleted){return(l.deleted?-1:1)}if(l.revisions.start===k.revisions.start){return(l.revisions.ids<k.revisions.ids?-1:1)}return(l.revisions.start<k.revisions.start?-1:1)};var c=function(k){var m=function(n){return function(p,o){if(p||o[0].error){i(n,p||o[0])}else{i(n,null,o[0])}}};var l={update_seq:0};l.get=function(q,o,p){if(o instanceof Function){p=o;o={}}var n=k.transaction([a],IDBTransaction.READ).objectStore(a).get(q);n.onsuccess=function(t){var r=t.target.result;if(!t.target.result||r.deleted){return i(p,{error:true,message:"Document does not exist"})}var s=k.transaction([b],IDBTransaction.READ).objectStore(b).get(r.seq);s.onsuccess=function(v){var u=v.target.result;u._id=r.id;u._rev=r.rev;p(null,u)}}};l.remove=function(o,n,p){if(n instanceof Function){p=n;n={}}o._deleted=true;return l.bulkDocs({docs:[o]},n,m(p))};l.put=l.post=function(o,n,p){if(n instanceof Function){p=n;n={}}l.bulkDocs({docs:[o]},n,m(p))};l.bulkDocs=function(u,n,v){if(n instanceof Function){v=n;n={}}var w="new_edits" in n?n._new_edits:true;var p=u.docs.map(function(x){return j(x,w)});p.sort(function(y,x){return h(y.metadata,x.metadata)});var o=IDBKeyRange.bound(p[0].metadata.id,p[p.length-1].metadata.id,false,false);var q=p.reduce(function(y,x){if(x.metadata.id===y[0][0].metadata.id){y[0].push(x)}else{y.unshift([x])}return y},[[p.shift()]]);var t=k.transaction([a,b],IDBTransaction.READ_WRITE);var r=[];t.oncomplete=function(x){i(v,null,r)};t.onerror=function(z){if(v){var y=z.target.errorCode;var x=Object.keys(IDBDatabaseException)[y].toLowerCase();v({error:z.type,reason:x})}};t.ontimeout=function(z){if(v){var y=z.target.errorCode;var x=Object.keys(IDBDatabaseException)[y].toLowerCase();v({error:z.type,reason:x})}};var s=t.objectStore(a).openCursor(o,IDBCursor.NEXT);s.onsuccess=function(z){var C=z.target.result;if(C){var B=q.shift();var y=B[0];var A=C.value.revisions.ids;if(A[A.length-1]!==y.metadata.revisions.ids[1]){r.push({error:true,message:"Invalid rev"});return C["continue"]()}var x=t.objectStore(b).put(y.data);x.onsuccess=function(D){y.metadata.seq=D.target.result;var E=t.objectStore(a).put(y.metadata);E.onsuccess=function(){r.push({id:y.metadata.id,rev:y.metadata.rev});return C["continue"]()}}}else{q.forEach(function(F){var E=F[0];if(E.metadata.deleted){r.push({error:true,message:"Can only delete things that exist"});return}var D=t.objectStore(b).add(E.data);D.onsuccess=function(G){E.metadata.seq=G.target.result;var H=t.objectStore(a).add(E.metadata);H.onsuccess=function(){r.push({id:E.metadata.id,rev:E.metadata.rev})}}})}}};l.changes=function(o){if(!o.seq){o.seq=0}var p=k.transaction(["document-store","sequence-index"]);var n=p.objectStore("sequence-index").openCursor(IDBKeyRange.lowerBound(o.seq));n.onsuccess=function(r){var s=r.target.result;if(!s){if(o.continuous){l.changes.addListener(o.onChange)}if(o.complete){o.complete()}}else{var q=s.value;p.objectStore("document-store").openCursor(IDBKeyRange.only(q.id)).onsuccess=function(t){var u={id:q.id,seq:q.seq,changes:q.changes,doc:t.value};o.onChange(u);s["continue"]()}}};n.onerror=function(q){if(o.continuous){l.changes.addListener(o.onChange)}i(o.complete)}};l.changes.listeners=[];l.changes.emit=function(){var n=arguments;l.changes.listeners.forEach(function(o){o.apply(o,n)})};l.changes.addListener=function(n){l.changes.listeners.push(n)};return l};g.open=function(k,m,n){if(m instanceof Function){n=m;m={}}k="pouch:"+k;if(k in d){return i(n,null,d[k])}var l=indexedDB.open(k);l.onupgradeneeded=function(p){var o=p.target.result;o.createObjectStore(a,{keyPath:"id"}).createIndex("seq","seq",{unique:true});o.createObjectStore(b,{autoIncrement:true})};l.onsuccess=function(q){var o=q.target.result;o.onversionchange=function(){o.close();delete d[k]};if(o.setVersion&&Number(o.version)!==e){var p=o.setVersion(e);p.onsuccess=function(){l.onupgradeneeded(q);l.onsuccess(q)};return}d[k]=c(o);i(n,null,d[k])};l.onerror=function(o){i(n,{error:"open",reason:o.toString()})}};g.deleteDatabase=function(k,m){var l=indexedDB.deleteDatabase("pouch:"+k);l.onsuccess=function(){i(m,null)};l.onerror=function(n){i(m,{error:"delete",reason:n.toString()})}}}).call(this);